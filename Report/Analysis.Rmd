---
title: "Analysis"
output: html_document
date: '2022-05-15'
---

```{r, echo = FALSE, message = FALSE}
source(here::here("Setup/setup.R"))
```

### Part 3 : Analysis 

```{r}
#library(visdat)
vis_miss(Gland_fin_tsibble)
```
We replace the last missing values by the last one without missing value, for a given station.
```{r}
Gland_fin_tsibble <- na_locf(Gland_fin_tsibble)
```

# 1. Gland Les Tuillières

We do an STL decomposition for *Bikes* in the station "Les Tuillières", to see any seasonality or trend in the time series. We then apply an ETS forecast with no trend and no seasonality. 

```{r}
#ETS Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Bike_Les_Tuillières))
components(dcmp) %>% autoplot() + xlab("Date")
```

```{r}
#ETS forecast
fit1 <- Gland_fin_tsibble %>%
model(ETS(Bike_Les_Tuillières ~ error("A") + trend("N") + season("A"), opt_crit = "mse"))
coefficients(fit1)
```

According to the fit, we should set alpha = 0.9697.
```{r}
FIT1 <- Gland_fin_tsibble %>%
model(ETS(Bike_Les_Tuillières ~ error("A") + trend("N", alpha=0.9697) + season("A")))
FIT1 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT1%>%accuracy()
```

We now apply the Mean, the Naive and the S_Naive models. 
```{r}
mean_model1 <- Gland_fin_tsibble %>% model( Mean = MEAN(Bike_Les_Tuillières),
Naive = NAIVE(Bike_Les_Tuillières),
S_Naive = SNAIVE(Bike_Les_Tuillières))

forecast_mean_model1 <- mean_model1 %>% forecast(h = 144) 
forecast_mean_model1 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```
We do the same for the *E_Bike* data, with an STL decomposition and an ETS forecast. 
```{r}
#STL Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Ebike_Les_Tuillières))
components(dcmp) %>% autoplot() + xlab("Date")
```

```{r}
#ETS forecast
fit.1 <- Gland_fin_tsibble %>%
model(ETS(Ebike_Les_Tuillières ~ error("A") + trend("N") + season("A"), opt_crit = "mse"))
coefficients(fit.1)
```
According to the fit, we should set alpha = 0.98604

```{r}
FIT.1 <- Gland_fin_tsibble %>%
model(ETS(Ebike_Les_Tuillières ~ error("A") + trend("N", alpha=0.98604) + season("A")))
FIT.1 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT.1%>%accuracy()
```

We also apply the Mean, the Naive and the S_Naive models. 
```{r}
mean_model.1 <- Gland_fin_tsibble %>% model( Mean = MEAN(Ebike_Les_Tuillières),
Naive = NAIVE(Ebike_Les_Tuillières),
S_Naive = SNAIVE(Ebike_Les_Tuillières))

forecast_mean_model.1 <- mean_model.1 %>% forecast(h = 144) 
forecast_mean_model.1 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

We now fit a multiple linear regression of Bikes with temperatures and precipitations. 
```{r}
fit.BikeTempPreLT <- Gland_fin_tsibble %>%
model(tslm = TSLM(Bike_Les_Tuillières ~ temp + prec + ensoll + vent + press))
report(fit.BikeTempPreLT)
```
The R squares is low (0,0854) but precipitation seems to be correlated. However it is not very logical that precipitation is positively correlated with the number of bikes borrowed in the station since the rain should normally not increase this number and rather decrease it. 
```{r}
fit.EBikeTempPreLT <- Gland_fin_tsibble %>%
model(tslm = TSLM(Ebike_Les_Tuillières ~ temp + prec + ensoll + vent + press))
report(fit.EBikeTempPreLT)
```
Here, for E_Bikes the results seem more convincing since precipitation is negatively correlated with the number of E_bikes borrowed. However, the temperature and sunlight are as well. 

Let's see the correlation between these weather variables and Bikes at Les Tuillières
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(23,35:39))
```
The number of borrowed bikes at Les Tuillières seems negatively correlated with pressure (-0,282***).

Let's see the correlation between these weather variables and E_Bikes at Les Tuillières.
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(24,35:39))
```

The number of borrowed E_bikes at Les Tuillières seems also correlated with pressure (0,165***) but negatively correlated with the others.

Here is a forecast with TSLM() on Bike 
```{r}
fit.BikeTempPreLT <- Gland_fin_tsibble %>% model(TSLM(Bike_Les_Tuillières ~ trend() + season()))
fc.BikeTempPreLT <- forecast(fit.BikeTempPreLT, h=144)
fc.BikeTempPreLT %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("Bike_LesTuillieres")

fit.BikeTempPreLT %>% gg_tsresiduals()
```

Here is a forecast with TSLM() on EBike 
```{r}
fit.EBikeTempPreLT <- Gland_fin_tsibble %>% model(TSLM(Ebike_Les_Tuillières ~ trend() + season()))
fc.EBikeTempPreLT <- forecast(fit.EBikeTempPreLT, h=144)
fc.EBikeTempPreLT %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("E_Bike_LesTuillieres")

fit.EBikeTempPreLT %>% gg_tsresiduals()
```


ARIMA model on Bike and Ebike 

```{r}
fitLT <- Gland_fin_tsibble %>%  model(ARIMA(Bike_Les_Tuillières))
report(fitLT)
fitLT %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

fit.LT <- Gland_fin_tsibble %>%  model(ARIMA(Ebike_Les_Tuillières))
report(fit.LT)
fit.LT %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

Tab1 <- predict(fit.LT, h = 144, ci = 0.90)
Tab1 <- Tab1[-c(1,3:4)]
```

Dynamic regression with temperature. 

```{r}
Gland_fin_tsibble %>% gather("var", "value", Bike_Les_Tuillières, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of bikes borrowed every 10 minutes in Gland Les Tuillières")

fitDR_LT <- Gland_fin_tsibble %>% model(ARIMA(Bike_Les_Tuillières ~ temp))
report(fitDR_LT)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_LT, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_LT, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_LT %>% gg_tsresiduals()

future_Gland_fin_tsibble1 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_LT, new_data = future_Gland_fin_tsibble1, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of bikes borrowed every 10 minutes in Gland Les Tuillières") 
```


```{r}
Gland_fin_tsibble %>% gather("var", "value", Ebike_Les_Tuillières, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of Ebikes borrowed every 10 minutes in Gland Les Tuillières")

fitDR_eLT <- Gland_fin_tsibble %>% model(ARIMA(Ebike_Les_Tuillières ~ temp))
report(fitDR_eLT)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_eLT, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_eLT, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_eLT %>% gg_tsresiduals()

future_Gland_fin_tsibble.1 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_eLT, new_data = future_Gland_fin_tsibble.1, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of Ebikes borrowed every 10 minutes in Gland Les Tuillières") 
```

--> Try dynamic regression with other weather variables


VAR model 
```{r}

df.gland <-Gland_fin_tsibble[,c("Bike_Eikenott","Ebike_Eikenott","Bike_En_Bord","Ebike_En_Bord","Ebike_Gare_Sud", "Bike_Gare_Sud","Ebike_La_Dôle","Bike_La_Dôle","Ebike_Grand_Rue", "Bike_Grand_Rue","Ebike_La_Falaise","Bike_La_Falaise","Ebike_La_Lignière","Bike_La_Lignière","Ebike_Les_Tuillières","Bike_Les_Tuillières","Ebike_Montoly","Bike_Montoly","Ebike_Swissquote","Bike_Swissquote","Ebike_UICN","Bike_UICN")]

VARselect(df.gland, lag.max = 4, type = "const", season = 4)
var.model_lev <- VAR(df.gland, p = 2, type = "const", season = 4)
accuracy(var.model_lev$varresult[[1]])

var.pred <- predict(var.model_lev, n.ahead = 144, ci = 0.90)

Var.stations <- as.data.frame(var.pred["fcst"])

colnames(Var.stations) <- c("Bike_Eikenott","Lower1.1","Upper1.1","CI1.1","Ebike_Eikenott","Lower1.2","Upper1.2","CI1.2","Bike_En_Bord","Lower2.1","Upper2.1","CI2.1","Ebike_En_Bord","Lower2.2","Upper2.2","CI2.2","Ebike_Gare_Sud","Lower3.1","Upper3.1","CI3.1","Bike_Gare_Sud","Lower3.2","Upper3.2","CI3.2","Ebike_La_Dôle","Lower4.1","Upper4.1","CI4.1","Bike_La_Dôle","Lower4.2","Upper4.2","CI4.2","Ebike_Grand_Rue","Lower5.1","Upper5.1","CI5.1","Bike_Grand_Rue","Lower5.2","Upper5.2","CI5.2","Ebike_La_Falaise","Lower6.1","Upper6.1","CI6.1","Bike_La_Falaise","Lower6.2","Upper6.2","CI6.2","Ebike_La_Lignière","Lower7.1","Upper7.1","CI7.1","Bike_La_Lignière","Lower7.2","Upper7.2","CI7.2","Ebike_Les_Tuillières","Lower8.1","Upper8.1","CI8.1","Bike_Les_Tuillières","Lower8.2","Upper8.2","CI8.2","Ebike_Montoly","Lower9.1","Upper9.1","CI9.1","Bike_Montoly","Lower9.2","Upper9.2","CI9.2","Ebike_Swissquote","Lower10.1","Upper10.1","CI10.1","Bike_Swissquote","Lower10.2","Upper10.2","CI10.2","Ebike_UICN","Lower11.1","Upper11.1","CI11.1","Bike_UICN","Lower11.2","Upper11.2","CI11.2")
View(Var.stations)

Var.stations <- floor(Var.stations)

#x11(); par(mai=rep(0.4, 4)); plot(var.pred) #Attention il faut XQUARTZ
#x11(); par(mai=rep(0.4, 4)); fanchart(var.pred)

Tab.fin <- Var.stations[,c(1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87)]

Tab.final <- cbind(Tab.fin,Tab1)

```









# 2. Gland Swissquote


We do an STL decomposition for *Bikes* in the station "Swissquote", to see any seasonality or trend in the time series. 

```{r}
#ETS Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Bike_Swissquote))
components(dcmp) %>% autoplot() + xlab("Date")
```

We then apply an ETS forecast with no trend and no seasonality. 

```{r}
#ETS forecast
fit2 <- Gland_fin_tsibble %>%
model(ETS(Bike_Swissquote ~ error("A") + trend("N") + season("A"), opt_crit = "mse"))
coefficients(fit2)
```

According to the fit, we should set alpha = 0.985587. 
```{r}
FIT2 <- Gland_fin_tsibble %>%
model(ETS(Bike_Swissquote ~ error("A") + trend("N", alpha=0.985587) + season("A")))
FIT2 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT2%>%accuracy()
```

We now apply the Mean, the Naive and the S_Naive models. 
```{r}
mean_model2 <- Gland_fin_tsibble %>% model( Mean = MEAN(Bike_Swissquote),
Naive = NAIVE(Bike_Swissquote),
S_Naive = SNAIVE(Bike_Swissquote))

forecast_mean_model2 <- mean_model2 %>% forecast(h = 144) 
forecast_mean_model2 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```
We do the same for the *E_Bike* data, with an STL decomposition and an ETS forecast. 
```{r}
#STL Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Ebike_Swissquote))
components(dcmp) %>% autoplot() + xlab("Date")
```
We then apply an ETS forecast with no trend and an additive seasonality (season_week, season_day, season_hour ?)
```{r}
#ETS forecast
fit.2 <- Gland_fin_tsibble %>%
model(ETS(Ebike_Swissquote ~ error("A") + trend("N") + season("A"), opt_crit = "mse"))
coefficients(fit.2)
```
According to the fit, we should set alpha = 0.99218.

```{r}
FIT.2 <- Gland_fin_tsibble %>%
model(ETS(Ebike_Swissquote ~ error("A") + trend("N", alpha=0.99218) + season("A")))
FIT.2 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT.2%>%accuracy()
```

We also apply the Mean, the Naive and the S_Naive models. 
```{r}
mean_model.2 <- Gland_fin_tsibble %>% model( Mean = MEAN(Ebike_Swissquote),
Naive = NAIVE(Ebike_Swissquote),
S_Naive = SNAIVE(Ebike_Swissquote))

forecast_mean_model.2 <- mean_model.2 %>% forecast(h = 144) 
forecast_mean_model.2 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

We now fit a multiple linear regression of Bikes with temperatures and precipitations. 
```{r}
fit.BikeTempPreS <- Gland_fin_tsibble %>%
model(tslm = TSLM(Bike_Swissquote ~ temp + prec + ensoll + vent + press))
report(fit.BikeTempPreS)
```
The R squares is low (0,135) but precipitation seems to be correlated. However it is not very logical that precipitation is positively correlated with the number of bikes borrowed in the station since the rain should normally not increase this number and rather decrease it. 
```{r}
fit.EBikeTempPreS <- Gland_fin_tsibble %>%
model(tslm = TSLM(Ebike_Swissquote ~ temp + prec + ensoll + vent + press))
report(fit.EBikeTempPreS)
```
Here, for E_Bikes the results seem more convincing since precipitation is negatively correlated with the number of E_bikes borrowed. Moreover, the sunlight is positively correlated. 

Let's see the correlation between these weather variables and Bikes at Swissquote.
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(29,35:39))
```
The number of borrowed bikes at Swissquote seems positively correlated with pressure (0,227***) and the wind.

Let's see the correlation between these weather variables and E_Bikes at Swissquote.
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(30,35:39))
```

The number of borrowed E_bikes at Swissquote seems correlated with sunlight and temperature.

Here is a forecast with TSLM() on Bike 
```{r}
fit.BikeTempPreS <- Gland_fin_tsibble %>% model(TSLM(Bike_Swissquote ~ trend() + season()))
fc.BikeTempPreS <- forecast(fit.BikeTempPreS, h=144)
fc.BikeTempPreS %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("Bike_Swissquote")

fit.BikeTempPreS %>% gg_tsresiduals()
```

Here is a forecast with TSLM() on EBike 
```{r}
fit.EBikeTempPreS <- Gland_fin_tsibble %>% model(TSLM(Ebike_Swissquote ~ trend() + season()))
fc.EBikeTempPreS <- forecast(fit.EBikeTempPreS, h=144)
fc.EBikeTempPreS %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("E_Bike_Swissquote")

fit.EBikeTempPreS %>% gg_tsresiduals()
```


ARIMA model on Bike and Ebike 

```{r}
fitS <- Gland_fin_tsibble %>%  model(ARIMA(Bike_Swissquote))
report(fitS)
fitS %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

fit.S <- Gland_fin_tsibble %>%  model(ARIMA(Ebike_Swissquote))
report(fit.S)
fit.S %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)
```

Dynamic regression with temperature 

```{r}
Gland_fin_tsibble %>% gather("var", "value", Bike_Swissquote, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of bikes borrowed every 10 minutes in Gland Swissquote")

fitDR_S <- Gland_fin_tsibble %>% model(ARIMA(Bike_Swissquote ~ temp))
report(fitDR_S)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_S, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_S, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_S %>% gg_tsresiduals()

future_Gland_fin_tsibble2 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_S, new_data = future_Gland_fin_tsibble2, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of bikes borrowed every 10 minutes in Gland Swissquote") 
```


```{r}
Gland_fin_tsibble %>% gather("var", "value", Ebike_Swissquote, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of Ebikes borrowed every 10 minutes in Gland Swissquote")

fitDR_eS <- Gland_fin_tsibble %>% model(ARIMA(Ebike_Swissquote ~ temp))
report(fitDR_eS)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_eS, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_eS, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_eS %>% gg_tsresiduals()

future_Gland_fin_tsibble.2 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_eS, new_data = future_Gland_fin_tsibble.2, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of Ebikes borrowed every 10 minutes in Gland Swissquote") 
```












------------------------------------------------------------------------------------------------------------------------------
# 3. Gland Gare Sud

### 3.1 STL Decomposition Bike
```{r}
#ETS Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Bike_Gare_Sud))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model Bike
```{r}
#ETS forecast
fit3 <- Gland_fin_tsibble %>%
model(ETS(Bike_Gare_Sud ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit3)
```

According to the fit, we should set alpha = 0.94.
```{r}
FIT3 <- Gland_fin_tsibble %>%
model(ETS(Bike_Gare_Sud ~ error("A") + trend("N", alpha=0.94) + season("N")))
FIT3 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT3%>%accuracy()
```
RMSE = 0.295

### Mean/Naive/S_Naive Model Bike
```{r}
mean_model3 <- Gland_fin_tsibble %>% model( Mean = MEAN(Bike_Gare_Sud),
Naive = NAIVE(Bike_Gare_Sud),
S_Naive = SNAIVE(Bike_Gare_Sud))

forecast_mean_model3 <- mean_model3 %>% forecast(h = 144) 
forecast_mean_model3 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### STL decomposition E-Bike
```{r}
#STL Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Ebike_Gare_Sud))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model E-Bike
```{r}
#ETS forecast
fit.3 <- Gland_fin_tsibble %>%
model(ETS(Ebike_Gare_Sud ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit.3)
```

According to the fit, we should set alpha = 0.95.
```{r}
FIT.3 <- Gland_fin_tsibble %>%
model(ETS(Ebike_Gare_Sud ~ error("A") + trend("N", alpha=0.95) + season("N")))
FIT.3 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT.3%>%accuracy()
```
RMSE = 0.442

### Mean/Naive/S_Naive Model E-Bike
```{r}
mean_model.3 <- Gland_fin_tsibble %>% model( Mean = MEAN(Ebike_Gare_Sud),
Naive = NAIVE(Ebike_Gare_Sud),
S_Naive = SNAIVE(Ebike_Gare_Sud))

forecast_mean_model.3 <- mean_model.3 %>% forecast(h = 144) 
forecast_mean_model.3 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### Multiple linear regression Model Bike
We now fit a multiple linear regression of Bikes with temperatures and precipitations. 
```{r}
fit.BikeTempPreLT3 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Bike_Gare_Sud ~ temp + prec + ensoll + vent + press))
report(fit.BikeTempPreLT3)
```
The R squares is low (0,105) but radiation and wind and seem to be positively correlated and pression positively correlated.  

### Multiple linear regression Model Bike
```{r}
fit.EBikeTempPreLT.3 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Ebike_Gare_Sud ~ temp + prec + ensoll + vent + press))
report(fit.EBikeTempPreLT.3)
```
Here, for E_Bikes all the results seem to be correlated but the R-squared is significantly low. Moreover, it is a little bit surprising that the radiation is negatively correlated, it should be the contrary.

Let's see the correlation between these weather variables and Bikes at Gare_Sud
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(8,35:39))
```
The number of borrowed bikes at Gare_Sud seems negatively correlated with wind (-0,212***).

Let's see the correlation between these weather variables and E_Bikes at Gare_Sud.
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(9,35:39))
```
The number of borrowed E_bikes at Gare_Sud seems to be negatively correlated with radiation (-0,139***) but positively correlated with the others.

### TSLM Model Bike
Here is a forecast with TSLM() on Bike 
```{r}
fit.BikeTempPreLT.3 <- Gland_fin_tsibble %>% model(TSLM(Bike_Gare_Sud ~ trend() + season()))
fc.BikeTempPreLT.3 <- forecast(fit.BikeTempPreLT.3, h=144)
fc.BikeTempPreLT.3 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("Bike_Gare_Sud")

fit.BikeTempPreLT.3 %>% gg_tsresiduals()
```

### TSLM Model E-Bike
Here is a forecast with TSLM() on EBike 
```{r}
fit.EBikeTempPreLT.3 <- Gland_fin_tsibble %>% model(TSLM(Ebike_Gare_Sud ~ trend() + season()))
fc.EBikeTempPreLT.3 <- forecast(fit.EBikeTempPreLT.3, h=144)
fc.EBikeTempPreLT.3 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("E_Bike_Gare_Sud")

fit.EBikeTempPreLT.3 %>% gg_tsresiduals()
```

### ARIMA model on Bike and Ebike 
```{r}
fitLT3 <- Gland_fin_tsibble %>%  model(ARIMA(Bike_Gare_Sud))
report(fitLT3)
fitLT3 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

fit.LT3 <- Gland_fin_tsibble %>%  model(ARIMA(Ebike_Gare_Sud))
report(fit.LT3)
fit.LT3 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)
```

### Dynamic regression with temperature Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Bike_Gare_Sud, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of bikes borrowed every 10 minutes in Gland Gare Sud")

fitDR_LT3 <- Gland_fin_tsibble %>% model(ARIMA(Bike_Gare_Sud ~ temp))
report(fitDR_LT3)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_LT3, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_LT3, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_LT3 %>% gg_tsresiduals()

future_Gland_fin_tsibble3 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_LT3, new_data = future_Gland_fin_tsibble3, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of bikes borrowed every 10 minutes in Gland Gare Sud") 
```

### Dynamic regression with temperature E-Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Ebike_Gare_Sud, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of Ebikes borrowed every 10 minutes in Gland Gare Sud")

fitDR_eLT3 <- Gland_fin_tsibble %>% model(ARIMA(Ebike_Gare_Sud ~ temp))
report(fitDR_eLT3)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_eLT3, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_eLT3, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_eLT3 %>% gg_tsresiduals()

future_Gland_fin_tsibble.3 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_eLT3, new_data = future_Gland_fin_tsibble.3, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of Ebikes borrowed every 10 minutes in Gland Gare Sud") 
```


------------------------------------------------------------------------------------------------------------------------------
# 4. Gland UICN

### 3.1 STL Decomposition Bike
```{r}
#ETS Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Bike_UICN))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model Bike
```{r}
#ETS forecast
fit4 <- Gland_fin_tsibble %>%
model(ETS(Bike_UICN ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit4)
```

According to the fit, we should set alpha = 0.95.
```{r}
FIT4 <- Gland_fin_tsibble %>%
model(ETS(Bike_UICN ~ error("A") + trend("N", alpha=0.95) + season("N")))
FIT4 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT4%>%accuracy()
```
RMSE = 0.268

### Mean/Naive/S_Naive Model Bike
```{r}
mean_model4 <- Gland_fin_tsibble %>% model( Mean = MEAN(Bike_UICN),
Naive = NAIVE(Bike_UICN),
S_Naive = SNAIVE(Bike_UICN))

forecast_mean_model4 <- mean_model4 %>% forecast(h = 144) 
forecast_mean_model4 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### STL decomposition E-Bike
```{r}
#STL Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Ebike_UICN))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model E-Bike
```{r}
#ETS forecast
fit.4 <- Gland_fin_tsibble %>%
model(ETS(Ebike_UICN ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit.4)
```

According to the fit, we should set alpha = 0.98.
```{r}
FIT.4 <- Gland_fin_tsibble %>%
model(ETS(Ebike_UICN ~ error("A") + trend("N", alpha=0.98) + season("N")))
FIT.4 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT.4%>%accuracy()
```
RMSE = 0.311

### Mean/Naive/S_Naive Model E-Bike
```{r}
mean_model.4 <- Gland_fin_tsibble %>% model( Mean = MEAN(Ebike_UICN),
Naive = NAIVE(Ebike_UICN),
S_Naive = SNAIVE(Ebike_UICN))

forecast_mean_model.4 <- mean_model.4 %>% forecast(h = 144) 
forecast_mean_model.4 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### Multiple linear regression Model Bike
We now fit a multiple linear regression of Bikes with temperatures and precipitations. 
```{r}
fit.BikeTempPreLT4 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Bike_UICN ~ temp + prec + ensoll + vent + press))
report(fit.BikeTempPreLT4)
```
The R squares is low (0,0503) but radiation and temperature seem to be positively correlated and pression and wind negatively correlated. which is consistent.  

### Multiple linear regression Model Bike
```{r}
fit.EBikeTempPreLT.4 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Ebike_UICN ~ temp + prec + ensoll + vent + press))
report(fit.EBikeTempPreLT.4)
```
Here, for E_Bikes all the results seem to be correlated but the R-squared is significantly low. 

Let's see the correlation between these weather variables and Bikes at Gare_Sud
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(32,35:39))
```
The number of borrowed bikes at UICN seems negatively correlated with wind (-0,126***) and positively with radiation (0,106***)

Let's see the correlation between these weather variables and E_Bikes at UICN.
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(33,35:39))
```
The number of borrowed E_bikes at UICN seems also positively correlated with radiation (0.141***).

### TSLM Model Bike
Here is a forecast with TSLM() on Bike 
```{r}
fit.BikeTempPreLT.4 <- Gland_fin_tsibble %>% model(TSLM(Bike_UICN ~ trend() + season()))
fc.BikeTempPreLT.4 <- forecast(fit.BikeTempPreLT.4, h=144)
fc.BikeTempPreLT.4 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("Bike_UICN")

fit.BikeTempPreLT.4 %>% gg_tsresiduals()
```

### TSLM Model E-Bike
Here is a forecast with TSLM() on EBike 
```{r}
fit.EBikeTempPreLT.4 <- Gland_fin_tsibble %>% model(TSLM(Ebike_UICN ~ trend() + season()))
fc.EBikeTempPreLT.4 <- forecast(fit.EBikeTempPreLT.4, h=144)
fc.EBikeTempPreLT.4 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("E_UICN")

fit.EBikeTempPreLT.4 %>% gg_tsresiduals()
```

### ARIMA model on Bike and Ebike 
```{r}
fitLT4 <- Gland_fin_tsibble %>%  model(ARIMA(Bike_UICN))
report(fitLT4)
fitLT4 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

fit.LT4 <- Gland_fin_tsibble %>%  model(ARIMA(Ebike_UICN))
report(fit.LT4)
fit.LT4 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)
```

### Dynamic regression with temperature Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Bike_UICN, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of bikes borrowed every 10 minutes in Gland UICN")

fitDR_LT4 <- Gland_fin_tsibble %>% model(ARIMA(Bike_UICN ~ temp))
report(fitDR_LT4)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_LT4, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_LT4, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_LT4 %>% gg_tsresiduals()

future_Gland_fin_tsibble4 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_LT4, new_data = future_Gland_fin_tsibble4, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of bikes borrowed every 10 minutes in Gland UICN") 
```

### Dynamic regression with temperature E-Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Ebike_UICN, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of Ebikes borrowed every 10 minutes in Gland UICN")

fitDR_eLT4 <- Gland_fin_tsibble %>% model(ARIMA(Ebike_UICN ~ temp))
report(fitDR_eLT4)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_eLT4, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_eLT4, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_eLT4 %>% gg_tsresiduals()

future_Gland_fin_tsibble.4 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_eLT4, new_data = future_Gland_fin_tsibble.4, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of Ebikes borrowed every 10 minutes in Gland UICN") 
```

------------------------------------------------------------------------------------------------------------------------------
# 5. Gland Montoly

### STL Decomposition Bike
```{r}
#ETS Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Bike_Montoly))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model Bike
```{r}
#ETS forecast
fit5 <- Gland_fin_tsibble %>%
model(ETS(Bike_Montoly ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit5)
```

According to the fit, we should set alpha = 0.87.
```{r}
FIT5 <- Gland_fin_tsibble %>%
model(ETS(Bike_Montoly ~ error("A") + trend("N", alpha=0.87) + season("N")))
FIT5 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT5%>%accuracy()
```
RMSE = 0.133

### Mean/Naive/S_Naive Model Bike
```{r}
mean_model5 <- Gland_fin_tsibble %>% model( Mean = MEAN(Bike_Montoly),
Naive = NAIVE(Bike_Montoly),
S_Naive = SNAIVE(Bike_Montoly))

forecast_mean_model5 <- mean_model5 %>% forecast(h = 144) 
forecast_mean_model5 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### STL decomposition E-Bike
```{r}
#STL Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Ebike_Montoly))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model E-Bike
```{r}
#ETS forecast
fit.5 <- Gland_fin_tsibble %>%
model(ETS(Ebike_Montoly ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit.5)
```

According to the fit, we should set alpha = 0.96.
```{r}
FIT.5 <- Gland_fin_tsibble %>%
model(ETS(Ebike_Montoly ~ error("A") + trend("N", alpha=0.96) + season("N")))
FIT.5 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT.5%>%accuracy()
```
RMSE = 0.202

### Mean/Naive/S_Naive Model E-Bike
```{r}
mean_model.5 <- Gland_fin_tsibble %>% model( Mean = MEAN(Ebike_Montoly),
Naive = NAIVE(Ebike_Montoly),
S_Naive = SNAIVE(Ebike_Montoly))

forecast_mean_model.5 <- mean_model.5 %>% forecast(h = 144) 
forecast_mean_model.5 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### Multiple linear regression Model Bike
We now fit a multiple linear regression of Bikes with temperatures and precipitations. 
```{r}
fit.BikeTempPreLT5 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Bike_Montoly ~ temp + prec + ensoll + vent + press))
report(fit.BikeTempPreLT5)
```
The R squares is low (0,194) but all the variables seem to be correlated.   

### Multiple linear regression Model Bike
```{r}
fit.EBikeTempPreLT.5 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Ebike_Montoly ~ temp + prec + ensoll + vent + press))
report(fit.EBikeTempPreLT.5)
```
Here, for E_Bikes the temperature is positively correlated and pression and precipitation negatively correlated but the R-squared is still significantly low. 

Let's see the correlation between these weather variables and Bikes at Montoly
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(26,35:39))
```
The number of borrowed bikes at Montoly seems negatively correlated with temperature (-0,394***).

Let's see the correlation between these weather variables and E_Bikes at Montoly.
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(27,35:39))
```
But the number of borrowed E_bikes at Montoly seems correlated with temperature (0.307***).

### TSLM Model Bike
Here is a forecast with TSLM() on Bike 
```{r}
fit.BikeTempPreLT.5 <- Gland_fin_tsibble %>% model(TSLM(Bike_Montoly ~ trend() + season()))
fc.BikeTempPreLT.5 <- forecast(fit.BikeTempPreLT.5, h=144)
fc.BikeTempPreLT.5 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("Bike_Montoly")

fit.BikeTempPreLT.5 %>% gg_tsresiduals()
```

### TSLM Model E-Bike
Here is a forecast with TSLM() on EBike 
```{r}
fit.EBikeTempPreLT.5 <- Gland_fin_tsibble %>% model(TSLM(Ebike_Montoly ~ trend() + season()))
fc.EBikeTempPreLT.5 <- forecast(fit.EBikeTempPreLT.5, h=144)
fc.EBikeTempPreLT.5 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("E_Montoly")

fit.EBikeTempPreLT.5 %>% gg_tsresiduals()
```

### ARIMA model on Bike and Ebike 
```{r}
fitLT5 <- Gland_fin_tsibble %>%  model(ARIMA(Bike_Montoly))
report(fitLT5)
fitLT5 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

fit.LT5 <- Gland_fin_tsibble %>%  model(ARIMA(Ebike_Montoly))
report(fit.LT5)
fit.LT5 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)
```

### Dynamic regression with temperature Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Bike_Montoly, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of bikes borrowed every 10 minutes in Gland Montoly")

fitDR_LT5 <- Gland_fin_tsibble %>% model(ARIMA(Bike_Montoly ~ temp))
report(fitDR_LT5)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_LT5, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_LT5, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_LT5 %>% gg_tsresiduals()

future_Gland_fin_tsibble5 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_LT5, new_data = future_Gland_fin_tsibble5, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of bikes borrowed every 10 minutes in Gland Montoly") 
```

### Dynamic regression with temperature E-Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Ebike_Montoly, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of Ebikes borrowed every 10 minutes in Gland Montoly")

fitDR_eLT5 <- Gland_fin_tsibble %>% model(ARIMA(Ebike_Montoly ~ temp))
report(fitDR_eLT5)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_eLT5, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_eLT5, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_eLT5 %>% gg_tsresiduals()

future_Gland_fin_tsibble.5 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_eLT5, new_data = future_Gland_fin_tsibble.5, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of Ebikes borrowed every 10 minutes in Gland Montoly") 
```

------------------------------------------------------------------------------------------------------------------------------
# 6. Gland Grande Rue

### STL Decomposition Bike
```{r}
#ETS Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Bike_Grand_Rue))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model Bike
```{r}
#ETS forecast
fit6 <- Gland_fin_tsibble %>%
model(ETS(Bike_Grand_Rue ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit6)
```

According to the fit, we should set alpha = 0.96.
```{r}
FIT6 <- Gland_fin_tsibble %>%
model(ETS(Bike_Grand_Rue ~ error("A") + trend("N", alpha=0.96) + season("N")))
FIT6 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT6%>%accuracy()
```
RMSE = 0.147

### Mean/Naive/S_Naive Model Bike
```{r}
mean_model6 <- Gland_fin_tsibble %>% model( Mean = MEAN(Bike_Grand_Rue),
Naive = NAIVE(Bike_Grand_Rue),
S_Naive = SNAIVE(Bike_Grand_Rue))

forecast_mean_model6 <- mean_model6 %>% forecast(h = 144) 
forecast_mean_model6 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### STL decomposition E-Bike
```{r}
#STL Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Ebike_Grand_Rue))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model E-Bike
```{r}
#ETS forecast
fit.6 <- Gland_fin_tsibble %>%
model(ETS(Ebike_Grand_Rue ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit.6)
```

According to the fit, we should set alpha = 1.
```{r}
FIT.6 <- Gland_fin_tsibble %>%
model(ETS(Ebike_Grand_Rue ~ error("A") + trend("N", alpha=1) + season("N")))
FIT.6 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT.6%>%accuracy()
```
RMSE = NaN

### Mean/Naive/S_Naive Model E-Bike
```{r}
mean_model.6 <- Gland_fin_tsibble %>% model( Mean = MEAN(Ebike_Grand_Rue),
Naive = NAIVE(Ebike_Grand_Rue),
S_Naive = SNAIVE(Ebike_Grand_Rue))

forecast_mean_model.6 <- mean_model.6 %>% forecast(h = 144) 
forecast_mean_model.6 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### Multiple linear regression Model Bike
We now fit a multiple linear regression of Bikes with temperatures and precipitations. 
```{r}
fit.BikeTempPreLT6 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Bike_Grand_Rue ~ temp + prec + ensoll + vent + press))
report(fit.BikeTempPreLT6)
```
The R squares is low (0,298) but all the variables seem to be correlated.   

### Multiple linear regression Model Bike
```{r}
fit.EBikeTempPreLT.6 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Ebike_Grand_Rue ~ temp + prec + ensoll + vent + press))
report(fit.EBikeTempPreLT.6)
```
Here, for E_Bikes the temperature, pression and radiation are negatively correlated.

Let's see the correlation between these weather variables and Bikes at Grand_Rue
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(11,35:39))
```
The number of borrowed bikes at Grand_Rue seems positively correlated with temperature (-0,527***).

Let's see the correlation between these weather variables and E_Bikes at Grand_Rue
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(12,35:39))
```
But the number of borrowed E_bikes at Grand_Rue seems negatively correlated with radiation (-0.271***).

### TSLM Model Bike
Here is a forecast with TSLM() on Bike 
```{r}
fit.BikeTempPreLT.6 <- Gland_fin_tsibble %>% model(TSLM(Bike_Grand_Rue ~ trend() + season()))
fc.BikeTempPreLT.6 <- forecast(fit.BikeTempPreLT.6, h=144)
fc.BikeTempPreLT.6 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("Bike_Grand_Rue")

fit.BikeTempPreLT.6 %>% gg_tsresiduals()
```

### TSLM Model E-Bike
Here is a forecast with TSLM() on EBike 
```{r}
fit.EBikeTempPreLT.6 <- Gland_fin_tsibble %>% model(TSLM(Ebike_Grand_Rue~ trend() + season()))
fc.EBikeTempPreLT.6 <- forecast(fit.EBikeTempPreLT.6, h=144)
fc.EBikeTempPreLT.6 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("E_Montoly")

fit.EBikeTempPreLT.6 %>% gg_tsresiduals()
```

### ARIMA model on Bike and Ebike 
```{r}
fitLT6 <- Gland_fin_tsibble %>%  model(ARIMA(Bike_Grand_Rue))
report(fitLT6)
fitLT6 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

fit.LT6 <- Gland_fin_tsibble %>%  model(ARIMA(Ebike_Grand_Rue))
report(fit.LT6)
fit.LT6 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)
```

### Dynamic regression with temperature Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Bike_Grand_Rue, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of bikes borrowed every 10 minutes in Gland Grand_Rue")

fitDR_LT6 <- Gland_fin_tsibble %>% model(ARIMA(Bike_Grand_Rue ~ temp))
report(fitDR_LT6)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_LT6, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_LT6, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_LT6 %>% gg_tsresiduals()

future_Gland_fin_tsibble6 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_LT6, new_data = future_Gland_fin_tsibble6, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of bikes borrowed every 10 minutes in Gland Grand_Rue") 
```

### Dynamic regression with temperature E-Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Ebike_Grand_Rue, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of Ebikes borrowed every 10 minutes in Gland Grand_Rue")

fitDR_eLT6 <- Gland_fin_tsibble %>% model(ARIMA(Ebike_Grand_Rue ~ temp))
report(fitDR_eLT6)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_eLT6, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_eLT6, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_eLT6 %>% gg_tsresiduals()

future_Gland_fin_tsibble.6 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_eLT6, new_data = future_Gland_fin_tsibble.6, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of Ebikes borrowed every 10 minutes in Gland Grand_Rue") 
```

------------------------------------------------------------------------------------------------------------------------------
# 7. Gland La Falaise

### STL Decomposition Bike
```{r}
#ETS Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Bike_La_Falaise))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model Bike
```{r}
#ETS forecast
fit7 <- Gland_fin_tsibble %>%
model(ETS(Bike_La_Falaise ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit7)
```

According to the fit, we should set alpha = 0.91.
```{r}
FIT7 <- Gland_fin_tsibble %>%
model(ETS(Bike_La_Falaise ~ error("A") + trend("N", alpha=0.91) + season("N")))
FIT7 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT7%>%accuracy()
```
RMSE = 0.162

### Mean/Naive/S_Naive Model Bike
```{r}
mean_model7 <- Gland_fin_tsibble %>% model( Mean = MEAN(Bike_La_Falaise),
Naive = NAIVE(Bike_La_Falaise),
S_Naive = SNAIVE(Bike_La_Falaise))

forecast_mean_model7 <- mean_model7 %>% forecast(h = 144) 
forecast_mean_model7 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### STL decomposition E-Bike
```{r}
#STL Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Ebike_La_Falaise))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model E-Bike
```{r}
#ETS forecast
fit.7 <- Gland_fin_tsibble %>%
model(ETS(Ebike_La_Falaise ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit.7)
```

According to the fit, we should set alpha = 0.98.
```{r}
FIT.7 <- Gland_fin_tsibble %>%
model(ETS(Ebike_La_Falaise ~ error("A") + trend("N", alpha=0.98) + season("N")))
FIT.7 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT.7%>%accuracy()
```
RMSE = 0.174

### Mean/Naive/S_Naive Model E-Bike
```{r}
mean_model.7 <- Gland_fin_tsibble %>% model( Mean = MEAN(Ebike_La_Falaise),
Naive = NAIVE(Ebike_La_Falaise),
S_Naive = SNAIVE(Ebike_La_Falaise))

forecast_mean_model.7 <- mean_model.7 %>% forecast(h = 144) 
forecast_mean_model.7 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### Multiple linear regression Model Bike
We now fit a multiple linear regression of Bikes with temperatures and precipitations. 
```{r}
fit.BikeTempPreLT7 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Bike_La_Falaise ~ temp + prec + ensoll + vent + press))
report(fit.BikeTempPreLT7)
```
The R squares is low (0,103).   

### Multiple linear regression Model Bike
```{r}
fit.EBikeTempPreLT.7 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Ebike_La_Falaise ~ temp + prec + ensoll + vent + press))
report(fit.EBikeTempPreLT.7)
```
Here, for E_Bikes ...

Let's see the correlation between these weather variables and Bikes at La_Falaise
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(17,35:39))
```
The number of borrowed bikes at La_Falaise seems positively correlated with pression (0.255***).

Let's see the correlation between these weather variables and E_Bikes at La_Falaise
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(18,35:39))
```
But the number of borrowed E_bikes at La_Falaise seems negatively correlated with pression (-0.356***).

### TSLM Model Bike
Here is a forecast with TSLM() on Bike 
```{r}
fit.BikeTempPreLT.7 <- Gland_fin_tsibble %>% model(TSLM(Bike_La_Falaise ~ trend() + season()))
fc.BikeTempPreLT.7 <- forecast(fit.BikeTempPreLT.7, h=144)
fc.BikeTempPreLT.7 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("Bike_La_Falaise")

fit.BikeTempPreLT.7 %>% gg_tsresiduals()
```

### TSLM Model E-Bike
Here is a forecast with TSLM() on EBike 
```{r}
fit.EBikeTempPreLT.7 <- Gland_fin_tsibble %>% model(TSLM(Ebike_La_Falaise ~ trend() + season()))
fc.EBikeTempPreLT.7 <- forecast(fit.EBikeTempPreLT.7, h=144)
fc.EBikeTempPreLT.7 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("E_La_Falaise")

fit.EBikeTempPreLT.7 %>% gg_tsresiduals()
```

### ARIMA model on Bike and Ebike 
```{r}
fitLT7 <- Gland_fin_tsibble %>%  model(ARIMA(Bike_La_Falaise))
report(fitLT7)
fitLT7 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

fit.LT7 <- Gland_fin_tsibble %>%  model(ARIMA(Ebike_La_Falaise))
report(fit.LT7)
fit.LT7 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)
```

### Dynamic regression with temperature Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Bike_La_Falaise, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of bikes borrowed every 10 minutes in Gland La_Falaise")

fitDR_LT7 <- Gland_fin_tsibble %>% model(ARIMA(Bike_La_Falaise ~ temp))
report(fitDR_LT7)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_LT7, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_LT7, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_LT7 %>% gg_tsresiduals()

future_Gland_fin_tsibble7 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_LT7, new_data = future_Gland_fin_tsibble7, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of bikes borrowed every 10 minutes in Gland La_Falaise") 
```

### Dynamic regression with temperature E-Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Ebike_La_Falaise, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of Ebikes borrowed every 10 minutes in Gland La_Falaise")

fitDR_eLT7 <- Gland_fin_tsibble %>% model(ARIMA(Ebike_La_Falaise ~ temp))
report(fitDR_eLT7)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_eLT7, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_eLT7, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_eLT7 %>% gg_tsresiduals()

future_Gland_fin_tsibble.7 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_eLT7, new_data = future_Gland_fin_tsibble.7, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of Ebikes borrowed every 10 minutes in Gland La_Falaise") 
```

------------------------------------------------------------------------------------------------------------------------------
# 8. Gland La Liginière

### STL Decomposition Bike
```{r}
#ETS Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Bike_La_Lignière))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model Bike
```{r}
#ETS forecast
fit8 <- Gland_fin_tsibble %>%
model(ETS(Bike_La_Lignière ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit8)
```

According to the fit, we should set alpha = 0.94.
```{r}
FIT8 <- Gland_fin_tsibble %>%
model(ETS(Bike_La_Lignière ~ error("A") + trend("N", alpha=0.94) + season("N")))
FIT8 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT8%>%accuracy()
```
RMSE = 0.255

### Mean/Naive/S_Naive Model Bike
```{r}
mean_model8 <- Gland_fin_tsibble %>% model( Mean = MEAN(Bike_La_Lignière),
Naive = NAIVE(Bike_La_Lignière),
S_Naive = SNAIVE(Bike_La_Lignière))

forecast_mean_model8 <- mean_model8 %>% forecast(h = 144) 
forecast_mean_model8 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### STL decomposition E-Bike
```{r}
#STL Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Ebike_La_Lignière))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model E-Bike
```{r}
#ETS forecast
fit.8 <- Gland_fin_tsibble %>%
model(ETS(Ebike_La_Lignière ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit.8)
```

According to the fit, we should set alpha = 0.96.
```{r}
FIT.8 <- Gland_fin_tsibble %>%
model(ETS(Ebike_La_Lignière ~ error("A") + trend("N", alpha=0.96) + season("N")))
FIT.8 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT.8%>%accuracy()
```
RMSE = 0.28

### Mean/Naive/S_Naive Model E-Bike
```{r}
mean_model.8 <- Gland_fin_tsibble %>% model( Mean = MEAN(Ebike_La_Lignière),
Naive = NAIVE(Ebike_La_Lignière),
S_Naive = SNAIVE(Ebike_La_Lignière))

forecast_mean_model.8 <- mean_model.8 %>% forecast(h = 144) 
forecast_mean_model.8 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### Multiple linear regression Model Bike
We now fit a multiple linear regression of Bikes with temperatures and precipitations. 
```{r}
fit.BikeTempPreLT8 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Bike_La_Lignière ~ temp + prec + ensoll + vent + press))
report(fit.BikeTempPreLT8)
```
The R squares is low (0,133) and all the variables are positively correlated.   

### Multiple linear regression Model Bike
```{r}
fit.EBikeTempPreLT.8 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Ebike_La_Lignière ~ temp + prec + ensoll + vent + press))
report(fit.EBikeTempPreLT.8)
```
Here, for E_Bikes ...

Let's see the correlation between these weather variables and Bikes at La_Lignière
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(20,35:39))
```
The number of borrowed bikes at La_Lignière seems positively correlated with pression (0.223***) and radiation (0.246***).

Let's see the correlation between these weather variables and E_Bikes at La_Lignière
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(21,35:39))
```
The number of borrowed E_bikes at La_Lignière seems also positively correlated with radiation (0.242***).

### TSLM Model Bike
Here is a forecast with TSLM() on Bike 
```{r}
fit.BikeTempPreLT.8 <- Gland_fin_tsibble %>% model(TSLM(Bike_La_Lignière ~ trend() + season()))
fc.BikeTempPreLT.8 <- forecast(fit.BikeTempPreLT.8, h=144)
fc.BikeTempPreLT.8 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("Bike_La_Lignière")

fit.BikeTempPreLT.8 %>% gg_tsresiduals()
```

### TSLM Model E-Bike
Here is a forecast with TSLM() on EBike 
```{r}
fit.EBikeTempPreLT.8 <- Gland_fin_tsibble %>% model(TSLM(Ebike_La_Lignière ~ trend() + season()))
fc.EBikeTempPreLT.8 <- forecast(fit.EBikeTempPreLT.8, h=144)
fc.EBikeTempPreLT.8 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("E_La_Lignière")

fit.EBikeTempPreLT.8 %>% gg_tsresiduals()
```

### ARIMA model on Bike and Ebike 
```{r}
fitLT8 <- Gland_fin_tsibble %>%  model(ARIMA(Bike_La_Lignière))
report(fitLT8)
fitLT8 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

fit.LT8 <- Gland_fin_tsibble %>%  model(ARIMA(Ebike_La_Lignière))
report(fit.LT8)
fit.LT8 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)
```

### Dynamic regression with temperature Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Bike_La_Lignière, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of bikes borrowed every 10 minutes in Gland La_Lignière")

fitDR_LT8 <- Gland_fin_tsibble %>% model(ARIMA(Bike_La_Lignière ~ temp))
report(fitDR_LT8)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_LT8, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_LT8, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_LT8 %>% gg_tsresiduals()

future_Gland_fin_tsibble8 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_LT8, new_data = future_Gland_fin_tsibble8, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of bikes borrowed every 10 minutes in Gland La_Lignière") 
```

### Dynamic regression with temperature E-Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Ebike_La_Lignière, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of Ebikes borrowed every 10 minutes in Gland La_Lignière")

fitDR_eLT8 <- Gland_fin_tsibble %>% model(ARIMA(Ebike_La_Lignière ~ temp))
report(fitDR_eLT8)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_eLT8, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_eLT8, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_eLT8 %>% gg_tsresiduals()

future_Gland_fin_tsibble.8 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_eLT8, new_data = future_Gland_fin_tsibble.8, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of Ebikes borrowed every 10 minutes in Gland La_Lignière") 
```

------------------------------------------------------------------------------------------------------------------------------
# 9. Gland Eiekenott

### STL Decomposition Bike
```{r}
#ETS Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Bike_Eikenott))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model Bike
```{r}
#ETS forecast
fit9 <- Gland_fin_tsibble %>%
model(ETS(Bike_Eikenott ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit9)
```

According to the fit, we should set alpha = 0.99.
```{r}
FIT9 <- Gland_fin_tsibble %>%
model(ETS(Bike_Eikenott ~ error("A") + trend("N", alpha=0.99) + season("N")))
FIT9 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT9%>%accuracy()
```
RMSE = 0.105

### Mean/Naive/S_Naive Model Bike
```{r}
mean_model9 <- Gland_fin_tsibble %>% model( Mean = MEAN(Bike_Eikenott),
Naive = NAIVE(Bike_Eikenott),
S_Naive = SNAIVE(Bike_Eikenott))

forecast_mean_model9 <- mean_model9 %>% forecast(h = 144) 
forecast_mean_model9 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### STL decomposition E-Bike
```{r}
#STL Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Ebike_Eikenott))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model E-Bike
```{r}
#ETS forecast
fit.9 <- Gland_fin_tsibble %>%
model(ETS(Ebike_Eikenott ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit.9)
```

According to the fit, we should set alpha = 0.95.
```{r}
FIT.9 <- Gland_fin_tsibble %>%
model(ETS(Ebike_Eikenott ~ error("A") + trend("N", alpha=0.95) + season("N")))
FIT.9 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT.9%>%accuracy()
```
RMSE = 0.263

### Mean/Naive/S_Naive Model E-Bike
```{r}
mean_model.9 <- Gland_fin_tsibble %>% model( Mean = MEAN(Ebike_Eikenott),
Naive = NAIVE(Ebike_Eikenott),
S_Naive = SNAIVE(Ebike_Eikenott))

forecast_mean_model.9 <- mean_model.9 %>% forecast(h = 144) 
forecast_mean_model.9 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### Multiple linear regression Model Bike
We now fit a multiple linear regression of Bikes with temperatures and precipitations. 
```{r}
fit.BikeTempPreLT9 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Bike_Eikenott ~ temp + prec + ensoll + vent + press))
report(fit.BikeTempPreLT9)
```
The R squares is low (0,18).   

### Multiple linear regression Model Bike
```{r}
fit.EBikeTempPreLT.9 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Ebike_Eikenott ~ temp + prec + ensoll + vent + press))
report(fit.EBikeTempPreLT.9)
```
Here, for E_Bikes ...

Let's see the correlation between these weather variables and Bikes at Eikenott
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(2,35:39))
```
The number of borrowed bikes at Eikenott seems positively correlated with pression (0.373***) .

Let's see the correlation between these weather variables and E_Bikes at Eikenott
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(3,35:39))
```
The number of borrowed E_bikes at Eikenott seems also positively correlated with pression (0.196***).

### TSLM Model Bike
Here is a forecast with TSLM() on Bike 
```{r}
fit.BikeTempPreLT.9 <- Gland_fin_tsibble %>% model(TSLM(Bike_Eikenott ~ trend() + season()))
fc.BikeTempPreLT.9 <- forecast(fit.BikeTempPreLT.9, h=144)
fc.BikeTempPreLT.9 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("Bike_Eikenott")

fit.BikeTempPreLT.9 %>% gg_tsresiduals()
```

### TSLM Model E-Bike
Here is a forecast with TSLM() on EBike 
```{r}
fit.EBikeTempPreLT.9 <- Gland_fin_tsibble %>% model(TSLM(Ebike_Eikenott ~ trend() + season()))
fc.EBikeTempPreLT.9 <- forecast(fit.EBikeTempPreLT.9, h=144)
fc.EBikeTempPreLT.9 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("E_Eikenott")

fit.EBikeTempPreLT.9 %>% gg_tsresiduals()
```

### ARIMA model on Bike and Ebike 
```{r}
fitLT9 <- Gland_fin_tsibble %>%  model(ARIMA(Bike_Eikenott))
report(fitLT9)
fitLT9 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

fit.LT9 <- Gland_fin_tsibble %>%  model(ARIMA(Ebike_Eikenott))
report(fit.LT9)
fit.LT9 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)
```

### Dynamic regression with temperature Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Bike_Eikenott, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of bikes borrowed every 10 minutes in Gland Eikenott")

fitDR_LT9 <- Gland_fin_tsibble %>% model(ARIMA(Bike_Eikenott ~ temp))
report(fitDR_LT9)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_LT9, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_LT9, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_LT9 %>% gg_tsresiduals()

future_Gland_fin_tsibble9 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_LT9, new_data = future_Gland_fin_tsibble9, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of bikes borrowed every 10 minutes in Gland Eikenott") 
```

### Dynamic regression with temperature E-Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Ebike_Eikenott, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of Ebikes borrowed every 10 minutes in Gland Eikenott")

fitDR_eLT9 <- Gland_fin_tsibble %>% model(ARIMA(Ebike_Eikenott ~ temp))
report(fitDR_eLT9)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_eLT9, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_eLT9, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_eLT9 %>% gg_tsresiduals()

future_Gland_fin_tsibble.9 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_eLT9, new_data = future_Gland_fin_tsibble.9, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of Ebikes borrowed every 10 minutes in Gland Eikenott") 
```

------------------------------------------------------------------------------------------------------------------------------
# 10. Gland La Dôle

### STL Decomposition Bike
```{r}
#ETS Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Bike_La_Dôle))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model Bike
```{r}
#ETS forecast
fit10 <- Gland_fin_tsibble %>%
model(ETS(Bike_La_Dôle ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit10)
```

According to the fit, we should set alpha = 0.99.
```{r}
FIT10 <- Gland_fin_tsibble %>%
model(ETS(Bike_La_Dôle ~ error("A") + trend("N", alpha=0.99) + season("N")))
FIT10 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT10%>%accuracy()
```
RMSE = 0.149

### Mean/Naive/S_Naive Model Bike
```{r}
mean_model10 <- Gland_fin_tsibble %>% model( Mean = MEAN(Bike_La_Dôle),
Naive = NAIVE(Bike_La_Dôle),
S_Naive = SNAIVE(Bike_La_Dôle))

forecast_mean_model10 <- mean_model10 %>% forecast(h = 144) 
forecast_mean_model10 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### STL decomposition E-Bike
```{r}
#STL Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Ebike_La_Dôle))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model E-Bike
```{r}
#ETS forecast
fit.10 <- Gland_fin_tsibble %>%
model(ETS(Ebike_La_Dôle ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit.10)
```

According to the fit, we should set alpha = 1.
```{r}
FIT.10 <- Gland_fin_tsibble %>%
model(ETS(Ebike_La_Dôle ~ error("A") + trend("N", alpha=1) + season("N")))
FIT.10 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT.10%>%accuracy()
```
RMSE = Nan

### Mean/Naive/S_Naive Model E-Bike
```{r}
mean_model.10 <- Gland_fin_tsibble %>% model( Mean = MEAN(Ebike_La_Dôle),
Naive = NAIVE(Ebike_La_Dôle),
S_Naive = SNAIVE(Ebike_La_Dôle))

forecast_mean_model.10 <- mean_model.10 %>% forecast(h = 144) 
forecast_mean_model.10 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### Multiple linear regression Model Bike
We now fit a multiple linear regression of Bikes with temperatures and precipitations. 
```{r}
fit.BikeTempPreLT10 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Bike_La_Dôle ~ temp + prec + ensoll + vent + press))
report(fit.BikeTempPreLT10)
```
The R squares is low (0,112).   

### Multiple linear regression Model Bike
```{r}
fit.EBikeTempPreLT.10 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Ebike_La_Dôle ~ temp + prec + ensoll + vent + press))
report(fit.EBikeTempPreLT.10)
```
Here, for E_Bikes ...

Let's see the correlation between these weather variables and Bikes at La_Dôle
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(14,35:39))
```
The number of borrowed bikes at La_Dôle seems negatively correlated with temperature (-0.238***) .

Let's see the correlation between these weather variables and E_Bikes at La_Dôle
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(15,35:39))
```
The number of borrowed E_bikes at La_Dôle seems positively correlated with pression (0.145***).

### TSLM Model Bike
Here is a forecast with TSLM() on Bike 
```{r}
fit.BikeTempPreLT.10 <- Gland_fin_tsibble %>% model(TSLM(Bike_La_Dôle ~ trend() + season()))
fc.BikeTempPreLT.10 <- forecast(fit.BikeTempPreLT.10, h=144)
fc.BikeTempPreLT.10 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("Bike_La_Dôle")

fit.BikeTempPreLT.10 %>% gg_tsresiduals()
```

### TSLM Model E-Bike
Here is a forecast with TSLM() on EBike 
```{r}
fit.EBikeTempPreLT.10 <- Gland_fin_tsibble %>% model(TSLM(Ebike_La_Dôle ~ trend() + season()))
fc.EBikeTempPreLT.10 <- forecast(fit.EBikeTempPreLT.10, h=144)
fc.EBikeTempPreLT.10 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("E_La_Dôle")

fit.EBikeTempPreLT.10 %>% gg_tsresiduals()
```

### ARIMA model on Bike and Ebike 
```{r}
fitLT10 <- Gland_fin_tsibble %>%  model(ARIMA(Bike_La_Dôle))
report(fitLT10)
fitLT10 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

fit.LT10 <- Gland_fin_tsibble %>%  model(ARIMA(Ebike_La_Dôle))
report(fit.LT10)
fit.LT10 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)
```

### Dynamic regression with temperature Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Bike_La_Dôle, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of bikes borrowed every 10 minutes in Gland La_Dôle")

fitDR_LT10 <- Gland_fin_tsibble %>% model(ARIMA(Bike_La_Dôle ~ temp))
report(fitDR_LT10)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_LT10, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_LT10, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_LT10 %>% gg_tsresiduals()

future_Gland_fin_tsibble10 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_LT10, new_data = future_Gland_fin_tsibble10, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of bikes borrowed every 10 minutes in Gland Eikenott") 
```

### Dynamic regression with temperature E-Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Ebike_La_Dôle, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of Ebikes borrowed every 10 minutes in Gland La_Dôle")

fitDR_eLT10 <- Gland_fin_tsibble %>% model(ARIMA(Ebike_La_Dôle ~ temp))
report(fitDR_eLT10)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_eLT10, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_eLT10, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_eLT10 %>% gg_tsresiduals()

future_Gland_fin_tsibble.10 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_eLT10, new_data = future_Gland_fin_tsibble.10, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of Ebikes borrowed every 10 minutes in Gland La_Dôle") 
```

------------------------------------------------------------------------------------------------------------------------------
# 11. Gland En Bord

### STL Decomposition Bike
```{r}
#ETS Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Bike_En_Bord))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model Bike
```{r}
#ETS forecast
fit11 <- Gland_fin_tsibble %>%
model(ETS(Bike_En_Bord ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit11)
```

According to the fit, we should set alpha = 0.95.
```{r}
FIT11 <- Gland_fin_tsibble %>%
model(ETS(Bike_En_Bord ~ error("A") + trend("N", alpha=0.95) + season("N")))
FIT11 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT11%>%accuracy()
```
RMSE = 0.0903

### Mean/Naive/S_Naive Model Bike
```{r}
mean_model11 <- Gland_fin_tsibble %>% model( Mean = MEAN(Bike_En_Bord),
Naive = NAIVE(Bike_En_Bord),
S_Naive = SNAIVE(Bike_En_Bord))

forecast_mean_model11 <- mean_model11 %>% forecast(h = 144) 
forecast_mean_model11 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### STL decomposition E-Bike
```{r}
#STL Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Ebike_En_Bord))
components(dcmp) %>% autoplot() + xlab("Date")
```

### ETS Model E-Bike
```{r}
#ETS forecast
fit.11 <- Gland_fin_tsibble %>%
model(ETS(Ebike_En_Bord ~ error("A") + trend("N") + season("N"), opt_crit = "mse"))
coefficients(fit.11)
```

According to the fit, we should set alpha = 93.
```{r}
FIT.11 <- Gland_fin_tsibble %>%
model(ETS(Ebike_En_Bord ~ error("A") + trend("N", alpha=0.93) + season("N")))
FIT.11 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble) +
theme(legend.position = "none")
FIT.11%>%accuracy()
```
RMSE = 0.0958

### Mean/Naive/S_Naive Model E-Bike
```{r}
mean_model.11 <- Gland_fin_tsibble %>% model( Mean = MEAN(Ebike_En_Bord),
Naive = NAIVE(Ebike_En_Bord),
S_Naive = SNAIVE(Ebike_En_Bord))

forecast_mean_model.11 <- mean_model.11 %>% forecast(h = 144) 
forecast_mean_model.11 %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

### Multiple linear regression Model Bike
We now fit a multiple linear regression of Bikes with temperatures and precipitations. 
```{r}
fit.BikeTempPreLT11 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Bike_En_Bord ~ temp + prec + ensoll + vent + press))
report(fit.BikeTempPreLT11)
```
The R squares is low (0,146).   

### Multiple linear regression Model Bike
```{r}
fit.EBikeTempPreLT.11 <- Gland_fin_tsibble %>%
model(tslm = TSLM(Ebike_En_Bord ~ temp + prec + ensoll + vent + press))
report(fit.EBikeTempPreLT.11)
```
Here, for E_Bikes ...

Let's see the correlation between these weather variables and Bikes at En_Bord
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(5,35:39))
```
The number of borrowed bikes at En_Bord seems negatively correlated with temperature (-0.327***) .

Let's see the correlation between these weather variables and E_Bikes at En_Bord
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(6,35:39))
```
The number of borrowed E_bikes at En_Bord seems positively correlated with temperature (0.347***).

### TSLM Model Bike
Here is a forecast with TSLM() on Bike 
```{r}
fit.BikeTempPreLT.11 <- Gland_fin_tsibble %>% model(TSLM(Bike_En_Bord ~ trend() + season()))
fc.BikeTempPreLT.11 <- forecast(fit.BikeTempPreLT.11, h=144)
fc.BikeTempPreLT.11 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("Bike_En_Bord")

fit.BikeTempPreLT.11 %>% gg_tsresiduals()
```

### TSLM Model E-Bike
Here is a forecast with TSLM() on EBike 
```{r}
fit.EBikeTempPreLT.11 <- Gland_fin_tsibble %>% model(TSLM(Ebike_En_Bord ~ trend() + season()))
fc.EBikeTempPreLT.11 <- forecast(fit.EBikeTempPreLT.11, h=144)
fc.EBikeTempPreLT.11 %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("E_La_Dôle")

fit.EBikeTempPreLT.11 %>% gg_tsresiduals()
```

### ARIMA model on Bike and Ebike 
```{r}
fitLT11 <- Gland_fin_tsibble %>%  model(ARIMA(Bike_En_Bord))
report(fitLT11)
fitLT11 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

fit.LT11 <- Gland_fin_tsibble %>%  model(ARIMA(Ebike_En_Bord))
report(fit.LT11)
fit.LT11 %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)
```

### Dynamic regression with temperature Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Bike_En_Bord, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of bikes borrowed every 10 minutes in Gland En_Bord")

fitDR_LT11 <- Gland_fin_tsibble %>% model(ARIMA(Bike_En_Bord ~ temp))
report(fitDR_LT11)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_LT11, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_LT11, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_LT11 %>% gg_tsresiduals()

future_Gland_fin_tsibble11 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_LT11, new_data = future_Gland_fin_tsibble11, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of bikes borrowed every 10 minutes in Gland En_Bord") 
```

### Dynamic regression with temperature E-Bike 
```{r}
Gland_fin_tsibble %>% gather("var", "value", Ebike_En_Bord, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of Ebikes borrowed every 10 minutes in Gland En_Bord")

fitDR_eLT11 <- Gland_fin_tsibble %>% model(ARIMA(Ebike_En_Bord ~ temp))
report(fitDR_eLT11)

bind_rows( 'Regression Errors' = as_tibble(residuals(fitDR_eLT11, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fitDR_eLT11, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fitDR_eLT11 %>% gg_tsresiduals()

future_Gland_fin_tsibble.11 <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fitDR_eLT11, new_data = future_Gland_fin_tsibble.11, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of Ebikes borrowed every 10 minutes in Gland En_Bord") 
```


