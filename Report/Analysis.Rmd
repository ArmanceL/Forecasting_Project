---
title: "Analysis"
output: html_document
date: '2022-05-15'
---

```{r, echo = FALSE, message = FALSE}
source(here::here("Setup/setup.R"))
```

### Part 3 : Analysis 


# 1. Gland Les Tuillières

We do an STL decomposition for *Bikes* in the station "Les Tuillières", to see any seasonality or trend in the time series. We then apply an ETS forecast with no trend and an additive seasonality (multiplicative ? ). 

```{r}
#ETS Decomposition Bike data 
#Gland_Les_Tuillières_Bike_tsibble <- Gland_Les_Tuillières_Bike_tsibble %>% fill_gaps(Bike=0,.full = TRUE)
#dcmp <- Gland_Les_Tuillières_Bike_tsibble %>% model(STL(Bike))
#components(dcmp) %>% autoplot() + xlab("Year")
#ETS forecast
#fit <- Gland_Les_Tuillières_Bike_tsibble %>%
#model(ETS(Bike ~ error("A") + trend("N", alpha = 0.5) + season("A"), opt_crit = "mse"))
#fit %>% forecast(h = 144) %>% autoplot(Gland_Les_Tuillières_Bike_tsibble, level = 0) +
#theme(legend.position = "none")

#le nouveau ne marche pas 
dcmp <- Gland_fin_tsibble %>% model(STL(Bike_Les_Tuillières))
components(dcmp) %>% autoplot() + xlab("Date")

#ETS forecast
fit <- Gland_fin_tsibble %>%
model(ETS(Bike_Les_Tuillières ~ error("A") + trend("N", alpha = 0.5) + season("A"), opt_crit = "mse"))
fit %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble, level = 0) +
theme(legend.position = "none")
```
We now apply the Mean, the Naive and the S_Naive models. 
```{r}
mean_model <- Gland_fin_tsibble %>% model( Mean = MEAN(Bike_Les_Tuillières),
Naive = NAIVE(Bike_Les_Tuillières),
S_Naive = SNAIVE(Bike_Les_Tuillières))

forecast_mean_model <- mean_model %>% forecast(h = 144) 
forecast_mean_model %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```
We do the same for the *E_Bike* data, with an STL decomposition and an ETS forecast. 
```{r}
#ETS Decomposition Bike data 
dcmp <- Gland_fin_tsibble %>% model(STL(Ebike_Les_Tuillières))
components(dcmp) %>% autoplot() + xlab("Date")

#ETS forecast
fit <- Gland_fin_tsibble %>%
model(ETS(Ebike_Les_Tuillières ~ error("A") + trend("N", alpha = 0.5) + season("A")))
fit %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble, level = 0) +
theme(legend.position = "none")
```
We also apply the Mean, the Naive and the S_Naive models. 
```{r}
mean_model <- Gland_fin_tsibble %>% model( Mean = MEAN(Ebike_Les_Tuillières),
Naive = NAIVE(Ebike_Les_Tuillières),
S_Naive = SNAIVE(Ebike_Les_Tuillières))

forecast_mean_model <- mean_model %>% forecast(h = 144) 
forecast_mean_model %>% autoplot(Gland_fin_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))
```

We now fit a multiple linear regression of Bikes with temperatures and precipitations. 
```{r}
fit.BikeTempPreLT <- Gland_fin_tsibble %>%
model(tslm = TSLM(Bike_Les_Tuillières ~ temp + prec + ensoll + vent + press))
report(fit.BikeTempPreLT)
```
The R squares is low (0,0854) but precipitation seems to be correlated. However it is not very logical that precipitation is positively correlated with the number of bikes borrowed in the station since the rain should normally not increase this number and rather decrease it. 
```{r}
fit.EBikeTempPreLT <- Gland_fin_tsibble %>%
model(tslm = TSLM(Ebike_Les_Tuillières ~ temp + prec + ensoll + vent + press))
report(fit.EBikeTempPreLT)
```
Here, for E_Bikes the results seem more convincing since precipitation is negatively correlated with the number of E_bikes borrowed. However, the temperature and sunlight are as well. 

Let's see the correlation between these weather variables and Bikes at Les Tuillières
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(23,35:39))
```
The number of borrowed bikes at Les Tuillières seems negatively correlated with pressure (-0,282***).

Let's see the correlation between these weather variables and E_Bikes at Les Tuillières.
```{r}
Gland_fin_tsibble %>% GGally::ggpairs(columns = c(24,35:39))
```

The number of borrowed E_bikes at Les Tuillières seems also correlated with pressure (0,165***) but negatively correlated with the others.

Here is a forecast with TSLM() on Bike 
```{r}
fit.BikeTempPreLT <- Gland_fin_tsibble %>% model(TSLM(Bike_Les_Tuillières ~ trend() + season()))
fc.BikeTempPreLT <- forecast(fit.BikeTempPreLT, h=144)
fc.BikeTempPreLT %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("Bike_LesTuillieres")

fit.BikeTempPreLT %>% gg_tsresiduals()
```

Here is a forecast with TSLM() on EBike 
```{r}
fit.EBikeTempPreLT <- Gland_fin_tsibble %>% model(TSLM(Ebike_Les_Tuillières ~ trend() + season()))
fc.EBikeTempPreLT <- forecast(fit.EBikeTempPreLT, h=144)
fc.EBikeTempPreLT %>% autoplot(Gland_fin_tsibble) + xlab("Date") + ylab("E_Bike_LesTuillieres")

fit.EBikeTempPreLT %>% gg_tsresiduals()
```


ARIMA model on Bike and Ebike 

```{r}
fit <- Gland_fin_tsibble %>%  model(ARIMA(Bike_Les_Tuillières))
report(fit)
fit %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)

fit <- Gland_fin_tsibble %>%  model(ARIMA(Ebike_Les_Tuillières))
report(fit)
fit %>% forecast(h = 144) %>% autoplot(Gland_fin_tsibble)
```

Dynamic regression

```{r}
Gland_fin_tsibble %>% gather("var", "value", Bike_Les_Tuillières, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of bikes borrowed every 10 minutes in Gland Les Tuillières")

fit <- Gland_fin_tsibble %>% model(ARIMA(Bike_Les_Tuillières ~ temp))
report(fit)

bind_rows( 'Regression Errors' = as_tibble(residuals(fit, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fit, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fit %>% gg_tsresiduals()

future_Gland_fin_tsibble <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fit, new_data = future_Gland_fin_tsibble, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of bikes borrowed every 10 minutes in Gland Les Tuillières") 
```


```{r}
Gland_fin_tsibble %>% gather("var", "value", Ebike_Les_Tuillières, temp) %>%
ggplot(aes(x = Date, y = value)) + geom_line() +
facet_grid(vars(var), scales = "free_y") +
labs(y = "", title = "Number of Ebikes borrowed every 10 minutes in Gland Les Tuillières")

fit <- Gland_fin_tsibble %>% model(ARIMA(Ebike_Les_Tuillières ~ temp))
report(fit)

bind_rows( 'Regression Errors' = as_tibble(residuals(fit, type = "regression")), 'ARIMA Errors' = as_tibble(residuals(fit, type = "innovation")), .id = "type") %>%
ggplot(aes(x = Date, y = .resid)) + geom_line() + facet_grid(vars(type), scales = "free_y") + labs(y = "")

fit %>% gg_tsresiduals()

future_Gland_fin_tsibble <- new_data(Gland_fin_tsibble, 144) %>% mutate(temp = mean(Gland_fin_tsibble$temp)) 
forecast(fit, new_data = future_Gland_fin_tsibble, h = 144) %>% autoplot(Gland_fin_tsibble) +
labs(y = "Forecast of the number of Ebikes borrowed every 10 minutes in Gland Les Tuillières") 
```


VAR model 
```{r}

```

GEM model 
```{r}

```









# 2. Gland Swissquote
```{r}
#Bike data 
Gland_Swissquote_Bike_tsibble <- as_tsibble(Gland_Swissquote%>%
  dplyr::select(Date, "Bike"= Bike), index = Date)

#Ebike data
Gland_Swissquote_E_Bike_tsibble <- as_tsibble(Gland_Swissquote%>%
  dplyr::select(Date, "E_Bike"= E_Bike), index = Date)

#autoplot
autoplot(Gland_Swissquote_Bike_tsibble)
autoplot(Gland_Swissquote_E_Bike_tsibble)
```

We do an STL decomposition to see if we could identify any trend or seasonality dor this station. 
```{r}
#Bike data 
Gland_Swissquote_Bike_tsibble <- Gland_Swissquote_Bike_tsibble %>% fill_gaps(Bike=0,.full = TRUE)
dcmp <- Gland_Swissquote_Bike_tsibble %>% model(STL(Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_Swissquote_Bike_tsibble %>%
model(ETS(Bike ~ error("A") + trend("N", alpha = 0.8) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_Swissquote_Bike_tsibble, level = 0) +
theme(legend.position = "none")

#EBike data 

Gland_Swissquote_E_Bike_tsibble <- Gland_Swissquote_E_Bike_tsibble %>% fill_gaps(E_Bike=0,.full = TRUE)
dcmp <- Gland_Swissquote_E_Bike_tsibble %>% model(STL(E_Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_Swissquote_E_Bike_tsibble %>%
model(ETS(E_Bike ~ error("A") + trend("N", alpha = 0.6) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_Swissquote_E_Bike_tsibble, level = 0) +
theme(legend.position = "none")
```
# 3. Gland Gare Sud
```{r}
#Bike data 
Gland_Gare_Sud_Bike_tsibble <- as_tsibble(Gland_Gare_Sud%>%
  dplyr::select(Date, "Bike"= Bike), index = Date)

#Ebike data
Gland_Gare_Sud_E_Bike_tsibble <- as_tsibble(Gland_Gare_Sud%>%
  dplyr::select(Date, "E_Bike"= E_Bike), index = Date)

#autoplot
autoplot(Gland_Gare_Sud_Bike_tsibble)
autoplot(Gland_Gare_Sud_E_Bike_tsibble)
```

We do an STL decomposition to see if we could identify any trend or seasonality dor this station. 
```{r}
#Bike data 
Gland_Gare_Sud_Bike_tsibble <- Gland_Gare_Sud_Bike_tsibble %>% fill_gaps(Bike=0,.full = TRUE)
dcmp <- Gland_Gare_Sud_Bike_tsibble %>% model(STL(Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_Gare_Sud_Bike_tsibble %>%
model(ETS(Bike ~ error("A") + trend("N", alpha = 0.8) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_Gare_Sud_Bike_tsibble, level = 0) +
theme(legend.position = "none")

#EBike data 

Gland_Gare_Sud_E_Bike_tsibble <- Gland_Gare_Sud_E_Bike_tsibble %>% fill_gaps(E_Bike=0,.full = TRUE)
dcmp <- Gland_Gare_Sud_E_Bike_tsibble %>% model(STL(E_Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_Gare_Sud_E_Bike_tsibble %>%
model(ETS(E_Bike ~ error("A") + trend("N", alpha = 0.6) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_Gare_Sud_E_Bike_tsibble, level = 0) +
theme(legend.position = "none")
```
# 4. Gland UICN
```{r}
#Bike data 
Gland_UICN_Bike_tsibble <- as_tsibble(Gland_UICN%>%
  dplyr::select(Date, "Bike"= Bike), index = Date)

#Ebike data
Gland_UICN_E_Bike_tsibble <- as_tsibble(Gland_UICN%>%
  dplyr::select(Date, "E_Bike"= E_Bike), index = Date)

#autoplot
autoplot(Gland_UICN_Bike_tsibble)
autoplot(Gland_UICN_E_Bike_tsibble)
```

We do an STL decomposition to see if we could identify any trend or seasonality dor this station. 
```{r}
#Bike data forecast
Gland_UICN_Bike_tsibble <- Gland_UICN_Bike_tsibble %>% fill_gaps(Bike=0,.full = TRUE) #utiliser Bike=na.locf 

#Gland_UICN_Bike_tsibble%>%gg_season(y=Bike)
#decompo STL pas possible 


mean_model <- Gland_UICN_Bike_tsibble %>% model( Mean = MEAN(Bike),
Naive = NAIVE(Bike),
S_Naive = SNAIVE(Bike))

forecast_mean_model <- mean_model %>% forecast(h = 36) 
forecast_mean_model %>% autoplot(Gland_UICN_Bike_tsibble, level = NULL) + guides(colour=guide_legend(title = "Forecast"))

#mean_model %>% accuracy
#beef.fit.NAIVE %>% accuracy()
#beef.fit.SNAIVE %>% accuracy()

#EBike data forecast
Gland_UICN_E_Bike_tsibble <- Gland_UICN_E_Bike_tsibble %>% fill_gaps(E_Bike=0,.full = TRUE) #na.locf marche pas 

dcmp <- Gland_UICN_E_Bike_tsibble %>% model(STL(E_Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_UICN_E_Bike_tsibble %>%
model(ETS(E_Bike ~ error("A") + trend("N", alpha = 0.5) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_UICN_E_Bike_tsibble, level = 0) +
theme(legend.position = "none")
```
# 5. Gland Montoly
```{r}
#Bike data 
Gland_Montoly_Bike_tsibble <- as_tsibble(Gland_Montoly%>%
  dplyr::select(Date, "Bike"= Bike), index = Date)

#Ebike data
Gland_Montoly_E_Bike_tsibble <- as_tsibble(Gland_Montoly%>%
  dplyr::select(Date, "E_Bike"= E_Bike), index = Date)

#autoplot
autoplot(Gland_Montoly_Bike_tsibble)
autoplot(Gland_Montoly_E_Bike_tsibble)
```

We do an STL decomposition to see if we could identify any trend or seasonality dor this station. 
```{r}
#Bike data forecast
Gland_Montoly_Bike_tsibble <- Gland_Montoly_Bike_tsibble %>% fill_gaps(Bike=0,.full = TRUE) #utiliser Bike=na.locf 

dcmp <- Gland_Montoly_Bike_tsibble %>% model(STL(Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_Montoly_Bike_tsibble %>%
model(ETS(Bike ~ error("A") + trend("N", alpha = 0.1) + season("N")))
fit %>% forecast(h = 36) %>% autoplot(Gland_Montoly_Bike_tsibble, level = 0) +
theme(legend.position = "none")

#EBike data forecast
Gland_Montoly_E_Bike_tsibble <- Gland_Montoly_E_Bike_tsibble %>% fill_gaps(E_Bike=0,.full = TRUE) #na.locf marche pas 

dcmp <- Gland_Montoly_E_Bike_tsibble %>% model(STL(E_Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_Montoly_E_Bike_tsibble %>%
model(ETS(E_Bike ~ error("A") + trend("N", alpha = 0.2) + season("N")))
fit %>% forecast(h = 36) %>% autoplot(Gland_Montoly_E_Bike_tsibble, level = 0) +
theme(legend.position = "none")

fit %>% forecast(h = 24) %>% autoplot(Gland_Montoly_E_Bike_tsibble) +
geom_line(aes(y = .fitted, colour = "Fitted"), data = augment(fit)) +
ylab("Gland_Montoly_E_Bike") + xlab("DATE")
```

# 6. Gland Grande Rue
```{r}
#Bike data 
Gland_Grand_Rue_Bike_tsibble <- as_tsibble(Gland_Grand_Rue%>%
  dplyr::select(Date, "Bike"= Bike), index = Date)

#Ebike data
Gland_Grand_Rue_E_Bike_tsibble <- as_tsibble(Gland_Grand_Rue%>%
  dplyr::select(Date, "E_Bike"= E_Bike), index = Date)

#autoplot
autoplot(Gland_Grand_Rue_Bike_tsibble)
autoplot(Gland_Grand_Rue_E_Bike_tsibble)
```
We do an STL decomposition to see if we could identify any trend or seasonality dor this station. 
```{r}
#Bike data forecast
Gland_Grand_Rue_Bike_tsibble <- Gland_Grand_Rue_Bike_tsibble %>% fill_gaps(Bike=0,.full = TRUE) #utiliser Bike=na.locf 

dcmp <- Gland_Grand_Rue_Bike_tsibble %>% model(STL(Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_Grand_Rue_Bike_tsibble %>%
model(ETS(Bike ~ error("A") + trend("N", alpha = 0.1) + season("A")))
fit %>% forecast(h = 24) %>% autoplot(Gland_Grand_Rue_Bike_tsibble, level = 0) +
theme(legend.position = "none")

#EBike data forecast
Gland_Grand_Rue_E_Bike_tsibble <- Gland_Grand_Rue_E_Bike_tsibble %>% fill_gaps(E_Bike=0,.full = TRUE) #na.locf marche pas 

dcmp <- Gland_Grand_Rue_E_Bike_tsibble %>% model(STL(E_Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_Grand_Rue_E_Bike_tsibble %>%
model(ETS(E_Bike ~ error("A") + trend("N", alpha = 0.1) + season("A")))
fit %>% forecast(h = 24) %>% autoplot(Gland_Grand_Rue_E_Bike_tsibble, level = 0) +
theme(legend.position = "none")
```


# 7. Gland La Falaise
```{r}
#Bike data 
Gland_La_Falaise_Bike_tsibble <- as_tsibble(Gland_La_Falaise%>%
  dplyr::select(Date, "Bike"= Bike), index = Date)

#Ebike data
Gland_La_Falaise_E_Bike_tsibble <- as_tsibble(Gland_La_Falaise%>%
  dplyr::select(Date, "E_Bike"= E_Bike), index = Date)

#autoplot
autoplot(Gland_La_Falaise_Bike_tsibble)
autoplot(Gland_La_Falaise_E_Bike_tsibble)
```

We do an STL decomposition to see if we could identify any trend or seasonality dor this station. 
```{r}
#Bike data 
Gland_La_Falaise_Bike_tsibble <- Gland_La_Falaise_Bike_tsibble %>% fill_gaps(Bike=0,.full = TRUE)
dcmp <- Gland_La_Falaise_Bike_tsibble %>% model(STL(Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_La_Falaise_Bike_tsibble %>%
model(ETS(Bike ~ error("A") + trend("N", alpha = 0.8) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_La_Falaise_Bike_tsibble, level = 0) +
theme(legend.position = "none")

#EBike data 

Gland_La_Falaise_E_Bike_tsibble <- Gland_La_Falaise_E_Bike_tsibble %>% fill_gaps(E_Bike=0,.full = TRUE)
dcmp <- Gland_La_Falaise_E_Bike_tsibble %>% model(STL(E_Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_La_Falaise_E_Bike_tsibble %>%
model(ETS(E_Bike ~ error("A") + trend("N", alpha = 0.6) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_La_Falaise_E_Bike_tsibble, level = 0) +
theme(legend.position = "none")
```

# 8. Gland La Liginière
```{r}
#Bike data 
Gland_La_Lignière_Bike_tsibble <- as_tsibble(Gland_La_Lignière%>%
  dplyr::select(Date, "Bike"= Bike), index = Date)

#Ebike data
Gland_La_Lignière_E_Bike_tsibble <- as_tsibble(Gland_La_Lignière%>%
  dplyr::select(Date, "E_Bike"= E_Bike), index = Date)

#autoplot
autoplot(Gland_La_Lignière_Bike_tsibble)
autoplot(Gland_La_Lignière_E_Bike_tsibble)
```
We do an STL decomposition to see if we could identify any trend or seasonality dor this station.
```{r}
#Bike data 
Gland_La_Lignière_Bike_tsibble <- Gland_La_Lignière_Bike_tsibble %>% fill_gaps(Bike=0,.full = TRUE)
dcmp <- Gland_La_Lignière_Bike_tsibble %>% model(STL(Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_La_Lignière_Bike_tsibble %>%
model(ETS(Bike ~ error("A") + trend("N", alpha = 0.8) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_La_Lignière_Bike_tsibble, level = 0) +
theme(legend.position = "none")

#EBike data 

Gland_La_Lignière_E_Bike_tsibble <- Gland_La_Lignière_E_Bike_tsibble %>% fill_gaps(E_Bike=0,.full = TRUE)
dcmp <- Gland_La_Lignière_E_Bike_tsibble %>% model(STL(E_Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_La_Lignière_E_Bike_tsibble %>%
model(ETS(E_Bike ~ error("A") + trend("N", alpha = 0.6) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_La_Lignière_E_Bike_tsibble, level = 0) +
theme(legend.position = "none")
```

# 9. Gland Eiekenott
```{r}
#Bike data 
Gland_Eikenott_Bike_tsibble <- as_tsibble(Gland_Eikenott%>%
  dplyr::select(Date, "Bike"= Bike), index = Date)

#Ebike data
Gland_Eikenott_E_Bike_tsibble <- as_tsibble(Gland_Eikenott%>%
  dplyr::select(Date, "E_Bike"= E_Bike), index = Date)

#autoplot
autoplot(Gland_Eikenott_Bike_tsibble)
autoplot(Gland_Eikenott_E_Bike_tsibble)
```

```{r}
#Bike data 
Gland_Eikenott_Bike_tsibble <- Gland_Eikenott_Bike_tsibble %>% fill_gaps(Bike=0,.full = TRUE)
dcmp <- Gland_Eikenott_Bike_tsibble %>% model(STL(Bike))
components(dcmp) %>% autoplot() + xlab("Year")
fit <- Gland_Eikenott_Bike_tsibble %>%
model(ETS(Bike ~ error("A") + trend("N", alpha = 0.8) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_Eikenott_Bike_tsibble, level = 0) +
theme(legend.position = "none")
#EBike data 
Gland_Eikenott_E_Bike_tsibble <- Gland_Eikenott_E_Bike_tsibble %>% fill_gaps(E_Bike=0,.full = TRUE)
dcmp <- Gland_Eikenott_E_Bike_tsibble %>% model(STL(E_Bike))
components(dcmp) %>% autoplot() + xlab("Year")
fit <- Gland_Eikenott_E_Bike_tsibble %>%
model(ETS(E_Bike ~ error("A") + trend("N", alpha = 0.6) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_Eikenott_E_Bike_tsibble, level = 0) +
theme(legend.position = "none")
```


# 10. Gland La Dôle
```{r}
#Bike data 
Gland_La_Dôle_Bike_tsibble <- as_tsibble(Gland_La_Dôle%>%
  dplyr::select(Date, "Bike"= Bike), index = Date)

#Ebike data
Gland_La_Dôle_E_Bike_tsibble <- as_tsibble(Gland_La_Dôle%>%
  dplyr::select(Date, "E_Bike"= E_Bike), index = Date)

#autoplot
autoplot(Gland_La_Dôle_Bike_tsibble)
autoplot(Gland_La_Dôle_E_Bike_tsibble)
```

```{r}
#Bike data 
Gland_La_Dôle_Bike_tsibble <- Gland_La_Dôle_Bike_tsibble %>% fill_gaps(Bike=0,.full = TRUE)
dcmp <- Gland_La_Dôle_Bike_tsibble %>% model(STL(Bike))
components(dcmp) %>% autoplot() + xlab("Year")
fit <- Gland_La_Dôle_Bike_tsibble %>%
model(ETS(Bike ~ error("A") + trend("N", alpha = 0.8) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_La_Dôle_Bike_tsibble, level = 0) +
theme(legend.position = "none")
#EBike data 
Gland_La_Dôle_E_Bike_tsibble <- Gland_La_Dôle_E_Bike_tsibble %>% fill_gaps(E_Bike=0,.full = TRUE)
dcmp <- Gland_La_Dôle_E_Bike_tsibble %>% model(STL(E_Bike))
components(dcmp) %>% autoplot() + xlab("Year")
fit <- Gland_La_Dôle_E_Bike_tsibble %>%
model(ETS(E_Bike ~ error("A") + trend("N", alpha = 0.6) + season("A")))
fit %>% forecast(h = 36) %>% autoplot(Gland_La_Dôle_E_Bike_tsibble, level = 0) +
theme(legend.position = "none")
```


# 11. Gland En Bord
```{r}
#Bike data 
Gland_En_Bord_Bike_tsibble <- as_tsibble(Gland_En_Bord%>%
  dplyr::select(Date, "Bike"= Bike), index = Date)

#Ebike data
Gland_En_Bord_E_Bike_tsibble <- as_tsibble(Gland_En_Bord%>%
  dplyr::select(Date, "E_Bike"= E_Bike), index = Date)

#autoplot
autoplot(Gland_En_Bord_Bike_tsibble)
autoplot(Gland_En_Bord_E_Bike_tsibble)
```

```{r}
#Bike data forecast
Gland_En_Bord_Bike_tsibble <- Gland_En_Bord_Bike_tsibble %>% fill_gaps(Bike=0,.full = TRUE) #utiliser Bike=na.locf 

dcmp <- Gland_En_Bord_Bike_tsibble %>% model(STL(Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_En_Bord_Bike_tsibble %>%
  model(ETS(Bike ~ error("A") + trend("N", alpha = 0.1) + season("A")))
fit %>% forecast(h = 24) %>% autoplot(Gland_En_Bord_Bike_tsibble, level = 0) +
theme(legend.position = "none")

#EBike data forecast
Gland_En_Bord_E_Bike_tsibble <- Gland_En_Bord_E_Bike_tsibble %>% fill_gaps(E_Bike=0,.full = TRUE) #na.locf marche pas 

dcmp <- Gland_En_Bord_E_Bike_tsibble %>% model(STL(E_Bike))
components(dcmp) %>% autoplot() + xlab("Year")

fit <- Gland_En_Bord_E_Bike_tsibble %>%
  model(ETS(E_Bike ~ error("A") + trend("N", alpha = 0.1) + season("A")))
fit %>% forecast(h = 24) %>% autoplot(Gland_En_Bord_E_Bike_tsibble, level = 0) +
theme(legend.position = "none")
```
