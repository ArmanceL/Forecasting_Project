---
title: "Data"
output: html_document
date: '2022-05-15'
---

```{r, echo = FALSE, message = FALSE}
source(here::here("Setup/setup.R"))
```

### Part 1 : Data preparation 

#Load the dataset
```{r}
setwd(here::here("Data/")) # Where are the data sets
load("~/Desktop/Forecasting/Forecasting II/Project 1/Forecasting_Project-main/Bikesharing_dataset.RData")
```

Load precipitation dataset in Gland 
```{r}
weather <- read.csv2(here::here("Data/order_103137_data.csv"))
weather$Year <- substr(weather$time, 1, 4)
weather$Month <- substr(weather$time, 5, 6)
weather$Day <- substr(weather$time, 7, 8)
weather$Hour <- substr(weather$time, 9, 10)
weather$Minute <- substr(weather$time, 11, 12)
weather <- weather[-c(1:2)]
weather <- rename(weather, precipitation = rre150z0)
#weather$rre150z0 <- as.numeric(weather$rre150z0)
#weather$Year <- as.numeric(weather$Year)
#weather$Month <- as.numeric(weather$Month)
#weather$Day <- as.numeric(weather$Day)
#weather$Hour <- as.numeric(weather$Hour)
#weather$Minute <- as.numeric(weather$Minute)

library(dplyr)
library(ggplot2)


weather$Date = str_c(weather$Year,"-",weather$Month,"-",weather$Day," ",weather$Hour,":",weather$Minute,":","00")

weather$Date = as.POSIXlt(weather$Date, tz=" ")
weather$Date = as.POSIXct(weather$Date)
```

Load temperature dataset 
```{r}
weather2 <- read.csv2(here::here("Data/temperatures_gland.csv"))

weather2$Year <- substr(weather2$time, 1, 4)
weather2$Month <- substr(weather2$time, 5, 6)
weather2$Day <- substr(weather2$time, 7, 8)
weather2$Hour <- substr(weather2$time, 9, 10)
weather2$Minute <- substr(weather2$time, 11, 12)
weather2 <- rename(weather2, temperature = tre200s0)

#weather$rre150z0 <- as.numeric(weather$rre150z0)
#weather$Year <- as.numeric(weather$Year)
#weather$Month <- as.numeric(weather$Month)
#weather$Day <- as.numeric(weather$Day)
#weather$Hour <- as.numeric(weather$Hour)
#weather$Minute <- as.numeric(weather$Minute)

library(dplyr)
library(ggplot2)

weather2$Date = str_c(weather2$Year,"-",weather2$Month,"-",weather2$Day," ",weather2$Hour,":",weather2$Minute,":","00")

weather2 <- weather2[-c(1:2,4:8)]
weather2$Date = as.POSIXlt(weather2$Date, tz=" ")
weather2$Date = as.POSIXct(weather2$Date)
```




#Building the dataset for every station needed and converting it as a dataframe + renameing the needed columns
```{r}
Gland_Les_Tuillières <- as.data.frame(series["Gland, Les Tuillières"])
colnames(Gland_Les_Tuillières) <- c("Bike","E_Bike","Capacity","Date","Name")

Gland_Swissquote <- as.data.frame(series["Gland, Swissquote"])
colnames(Gland_Swissquote) <- c("Bike","E_Bike","Capacity","Date","Name")

Gland_Gare_Sud <- as.data.frame(series["Gland, Gare Sud, travaux, déplacée de 20m en mars-avril"])
colnames(Gland_Gare_Sud) <- c("Bike","E_Bike","Capacity","Date","Name")

Gland_UICN <- as.data.frame(series["Gland, UICN"])
colnames(Gland_UICN) <- c("Bike","E_Bike","Capacity","Date","Name")

Gland_Montoly <- as.data.frame(series["Gland, Montoly"])
colnames(Gland_Montoly) <- c("Bike","E_Bike","Capacity","Date","Name")

Gland_Grand_Rue <- as.data.frame(series["Gland, Grand'Rue"])
colnames(Gland_Grand_Rue) <- c("Bike","E_Bike","Capacity","Date","Name")

Gland_La_Falaise <- as.data.frame(series["Gland, La Falaise"])
colnames(Gland_La_Falaise) <- c("Bike","E_Bike","Capacity","Date","Name")

Gland_La_Lignière <- as.data.frame(series["Gland, La Lignière"])
colnames(Gland_La_Lignière) <- c("Bike","E_Bike","Capacity","Date","Name")

Gland_Eikenott <- as.data.frame(series["Gland, Eikenott"])
colnames(Gland_Eikenott) <- c("Bike","E_Bike","Capacity","Date","Name")

Gland_La_Dôle <- as.data.frame(series["Gland, La Dôle"])
colnames(Gland_La_Dôle) <- c("Bike","E_Bike","Capacity","Date","Name")

Gland_En_Bord <- as.data.frame(series["Gland, En Bord"])
colnames(Gland_En_Bord) <- c("Bike","E_Bike","Capacity","Date","Name")

```

#searching for NA values
```{r}
which(is.na(Gland_Les_Tuillières))
which(is.na(Gland_Swissquote))
which(is.na(Gland_Gare_Sud1))
which(is.na(Gland_Gare_Sud2))
which(is.na(Gland_UICN))
which(is.na(Gland_Montoly))
which(is.na(Gland_Grand_Rue))
which(is.na(Gland_La_Falaise))
which(is.na(Gland_La_Lignière))
which(is.na(Gland_Eikenott))
which(is.na(Gland_La_Dôle))
which(is.na(Gland_En_Bord))
```

#Look at the 2 dataset with NA values (both grare sud)
Gland Gare is composed by 2 dataset with null data because of works changement -> eliminate the null data and bind in a unique dataset 
```{r}
#Gland_Gare_Sud1 <- Gland_Gare_Sud1[c(1:256), ]

#Gland_Gare_Sud2 <- Gland_Gare_Sud2[c(257:1975), ]

#Gland_Gare_Sud <- bind_rows(Gland_Gare_Sud1, Gland_Gare_Sud2)
#Gland_Gare_Sud
```

The first 117 rows are 1 per our and not every 10 minuts. So we eliminate them.
```{r}
nobs <- nrow(Gland_Eikenott)
Gland_Eikenott <- Gland_Eikenott[c(118:nobs), ]
Gland_En_Bord <- Gland_En_Bord[c(118:nobs), ]
Gland_Gare_Sud <- Gland_Gare_Sud[c(118:nobs), ]
Gland_Grand_Rue <- Gland_Grand_Rue[c(118:nobs), ]
Gland_La_Dôle <- Gland_La_Dôle[c(118:nobs), ]
Gland_La_Falaise <- Gland_La_Falaise[c(118:nobs), ]
Gland_Les_Tuillières <- Gland_Les_Tuillières[c(118:nobs), ]
Gland_Montoly <- Gland_Montoly[c(118:nobs), ]
Gland_Swissquote <- Gland_Swissquote[c(118:nobs), ]
Gland_UICN <- Gland_UICN[c(118:nobs), ]
Gland_La_Lignière <- Gland_La_Lignière[c(118:nobs), ]
```

The city of Gland has 11 stations and each of them has either classic bikes or electric bikes (e-bike). This includes 1858 observations and 2 variables for each station and each type of bike.
**Stations**:
1. Gland_Les_Tuillières 
2. Gland_Swissquote 
3. Gland_Gare_Sud
4. Gland_UICN 
5. Gland_Montoly 
6. Gland_Grande_Rue 
7. Gland_La_Falaise 
8. Gland_La_Lignère 
9. Gland_Eikenott 
10. Gland_La_Dôle 
11. Gland_En_Bord 
**Variables**
1. Date : *date* Borrowing date of the bike
2. Bike : *num* Number of the borrowed bike 
